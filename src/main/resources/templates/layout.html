<!DOCTYPE html>
<html lang="en" th:lang="${#locale.language}" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title th:text="${pageTitle}">Jan Charamza</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <link rel="stylesheet" th:href="@{/css/footer.css}">
  <link rel="stylesheet" th:href="@{/css/privacy-policy.css}">
  <link rel="stylesheet" th:href="@{/css/legal-pages.css}">
  <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
</head>
<body>
<nav class="navbar">
  <div class="nav-container">
    <a th:href="@{/}" class="nav-logo">azmarach.work</a>
    <div class="nav-menu" id="nav-menu">
      <a th:href="@{/}" class="nav-link" th:classappend="${currentUri == '/' ? 'active' : ''}" th:text="#{nav.home}">Home</a>
      <a th:href="@{/about}" class="nav-link" th:classappend="${currentUri == '/about' ? 'active' : ''}" th:text="#{nav.about}">About</a>
      <a th:href="@{/projects}" class="nav-link" th:classappend="${currentUri == '/projects' ? 'active' : ''}" th:text="#{nav.projects}">Projects</a>
      <a th:href="@{/blog}" class="nav-link" th:classappend="${currentUri == '/blog' ? 'active' : ''}" th:text="#{nav.blog}">Blog</a>
      <a th:href="@{/contact}" class="nav-link" th:classappend="${currentUri == '/contact' ? 'active' : ''}" th:text="#{nav.contact}">Contact</a>

      <!-- Language Switcher -->
      <div class="language-switcher">
        <a th:href="@{${currentUri}(lang='en')}" class="lang-link" th:classappend="${#locale.language == 'en' ? 'active' : ''}">EN</a>
        <span class="lang-separator">|</span>
        <a th:href="@{${currentUri}(lang='cs')}" class="lang-link" th:classappend="${#locale.language == 'cs' ? 'active' : ''}">CZ</a>
      </div>
    </div>
    <div class="hamburger" id="hamburger">
      <span class="bar"></span>
      <span class="bar"></span>
      <span class="bar"></span>
    </div>
  </div>
</nav>

<main class="main-content">
  <div layout:fragment="content">
    <!-- Page content will be inserted here -->
  </div>
</main>

<footer class="footer">
  <div class="footer-container">
    <div class="footer-content">
      <div class="footer-left">
        <p th:text="#{footer.copyright}">&copy; 2025 Jan Charamza. All rights reserved.</p>
      </div>
      <div class="footer-center">
        <div class="footer-links">
          <a th:href="@{/privacy-policy}" class="footer-link" th:text="#{footer.privacy}">Privacy Policy</a>
          <span class="footer-separator">|</span>
          <a th:href="@{/terms-of-use}" class="footer-link" th:text="#{footer.terms}">Terms of Use</a>
          <span class="footer-separator">|</span>
          <a th:href="@{/cookie-notice}" class="footer-link" th:text="#{footer.cookies}">Cookie Notice</a>
          <span class="footer-separator">|</span>
          <a th:href="@{/contact}" class="footer-link" th:text="#{footer.contact}">Contact</a>
        </div>
      </div>
      <div class="footer-right">
        <div class="social-links">
          <a href="https://github.com/jancharamza" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.30.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
          </a>
          <a href="https://linkedin.com/in/jancharamza" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Cookie Consent Banner -->
<div class="cookie-consent-banner" id="cookieConsentBanner">
  <div class="cookie-consent-container">
    <div class="cookie-consent-content">
      <div class="cookie-consent-title">
        <span class="cookie-icon">üç™</span>
        <span th:text="#{cookie.banner.title}">Cookie Notice</span>
      </div>
      <div class="cookie-consent-text">
        <span th:text="#{cookie.banner.text}">We use cookies to enhance your browsing experience, serve personalized content, and analyze our traffic. By clicking "Accept All", you consent to our use of cookies.</span>
        <a th:href="@{/cookie-notice}" class="cookie-consent-link" th:text="#{cookie.banner.learn.more}">Learn more in our Cookie Notice</a>.
      </div>
    </div>
    <div class="cookie-consent-actions">
      <button class="cookie-consent-btn cookie-consent-btn-decline" onclick="declineCookies()" th:text="#{cookie.banner.decline}">
        Decline
      </button>
      <button class="cookie-consent-btn cookie-consent-btn-settings" onclick="showCookieSettings()" th:text="#{cookie.banner.settings}">
        Settings
      </button>
      <button class="cookie-consent-btn cookie-consent-btn-accept" onclick="acceptAllCookies()" th:text="#{cookie.banner.accept}">
        Accept All
      </button>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div class="cookie-settings-overlay" id="cookieSettingsOverlay">
  <div class="cookie-settings-modal">
    <div class="cookie-settings-header">
      <div class="cookie-settings-title" th:text="#{cookie.settings.title}">Cookie Settings</div>
      <div class="cookie-settings-description" th:text="#{cookie.settings.description}">
        Manage your cookie preferences. You can enable or disable different types of cookies below.
      </div>
    </div>

    <div class="cookie-settings-content">
      <!-- Essential Cookies -->
      <div class="cookie-category">
        <div class="cookie-category-header">
          <div class="cookie-category-title" th:text="#{cookie.category.essential.title}">Essential Cookies</div>
          <label class="cookie-toggle">
            <input type="checkbox" checked disabled>
            <span class="cookie-toggle-slider"></span>
          </label>
        </div>
        <div class="cookie-category-description" th:text="#{cookie.category.essential.description}">
          These cookies are necessary for the website to function and cannot be switched off. They are usually only set in response to actions made by you which amount to a request for services.
        </div>
      </div>

      <!-- Preference Cookies -->
      <div class="cookie-category">
        <div class="cookie-category-header">
          <div class="cookie-category-title" th:text="#{cookie.category.preference.title}">Preference Cookies</div>
          <label class="cookie-toggle">
            <input type="checkbox" id="preferenceCookies" checked>
            <span class="cookie-toggle-slider"></span>
          </label>
        </div>
        <div class="cookie-category-description" th:text="#{cookie.category.preference.description}">
          These cookies enable the website to provide enhanced functionality and personalization. They may be set by us or by third party providers whose services we have added to our pages.
        </div>
      </div>

      <!-- Analytics Cookies -->
      <div class="cookie-category">
        <div class="cookie-category-header">
          <div class="cookie-category-title" th:text="#{cookie.category.analytics.title}">Analytics Cookies</div>
          <label class="cookie-toggle">
            <input type="checkbox" id="analyticsCookies">
            <span class="cookie-toggle-slider"></span>
          </label>
        </div>
        <div class="cookie-category-description" th:text="#{cookie.category.analytics.description}">
          These cookies allow us to count visits and traffic sources so we can measure and improve the performance of our site. They help us to know which pages are the most and least popular.
        </div>
      </div>

      <!-- Marketing Cookies -->
      <div class="cookie-category">
        <div class="cookie-category-header">
          <div class="cookie-category-title" th:text="#{cookie.category.marketing.title}">Marketing Cookies</div>
          <label class="cookie-toggle">
            <input type="checkbox" id="marketingCookies">
            <span class="cookie-toggle-slider"></span>
          </label>
        </div>
        <div class="cookie-category-description" th:text="#{cookie.category.marketing.description}">
          These cookies may be set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant adverts on other sites.
        </div>
      </div>
    </div>

    <div class="cookie-settings-actions">
      <button class="cookie-settings-btn cookie-settings-btn-cancel" onclick="closeCookieSettings()" th:text="#{cookie.settings.cancel}">
        Cancel
      </button>
      <button class="cookie-settings-btn cookie-settings-btn-save" onclick="saveCookieSettings()" th:text="#{cookie.settings.save}">
        Save Settings
      </button>
    </div>
  </div>
</div>

<script>
  console.log('=== COOKIE CONSENT INLINE SCRIPT LOADED ===');

  function setCookiePreference(type, value) {
      const expires = new Date();
      expires.setFullYear(expires.getFullYear() + 1);
      document.cookie = `cookie_${type}=${value}; expires=${expires.toUTCString()}; path=/; SameSite=Lax`;
      console.log(`Cookie preference set: ${type} = ${value}`);
  }

  function setCookieConsentStatus(status) {
      const expires = new Date();
      expires.setFullYear(expires.getFullYear() + 1);
      document.cookie = `cookie_consent=${status}; expires=${expires.toUTCString()}; path=/; SameSite=Lax`;
      console.log(`Cookie consent status set: ${status}`);
  }

  function getCookieValue(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
      return null;
  }

  function hasGivenConsent() {
      const consent = getCookieValue('cookie_consent');
      return consent !== null;
  }

  function getCookiePreference(type) {
      return getCookieValue(`cookie_${type}`) === 'true';
  }

  function showCookieBanner() {
      const banner = document.getElementById('cookieConsentBanner');
      if (banner) {
          banner.classList.add('show');
          console.log('Cookie banner shown');
      } else {
          console.error('Cookie banner element not found');
      }
  }

  function hideCookieBanner() {
      const banner = document.getElementById('cookieConsentBanner');
      if (banner) {
          banner.classList.remove('show');
          console.log('Cookie banner hidden');
      }
  }

  function showCookieSettings() {
      const overlay = document.getElementById('cookieSettingsOverlay');
      if (overlay) {
          overlay.classList.add('show');
          document.body.style.overflow = 'hidden';
          loadCookiePreferences();
          console.log('Cookie settings shown');
      }
  }

  function closeCookieSettings() {
      const overlay = document.getElementById('cookieSettingsOverlay');
      if (overlay) {
          overlay.classList.remove('show');
          document.body.style.overflow = '';
          console.log('Cookie settings closed');
      }
  }

  function acceptAllCookies() {
      console.log('Accepting all cookies...');
      setCookiePreference('essential', true);
      setCookiePreference('preference', true);
      setCookiePreference('analytics', true);
      setCookiePreference('marketing', true);
      setCookieConsentStatus('accepted');
      hideCookieBanner();
      initializeOptionalServices();
      showNotification('All cookies accepted', 'success');
  }

  function declineCookies() {
      console.log('Declining optional cookies...');
      setCookiePreference('essential', true);
      setCookiePreference('preference', false);
      setCookiePreference('analytics', false);
      setCookiePreference('marketing', false);
      setCookieConsentStatus('declined');
      hideCookieBanner();
      showNotification('Optional cookies declined', 'info');
  }

  function saveCookieSettings() {
      console.log('Saving cookie settings...');
      const preferences = document.getElementById('preferenceCookies')?.checked || false;
      const analytics = document.getElementById('analyticsCookies')?.checked || false;
      const marketing = document.getElementById('marketingCookies')?.checked || false;

      setCookiePreference('essential', true);
      setCookiePreference('preference', preferences);
      setCookiePreference('analytics', analytics);
      setCookiePreference('marketing', marketing);
      setCookieConsentStatus('customized');

      closeCookieSettings();
      hideCookieBanner();
      initializeOptionalServices();
      showNotification('Cookie preferences saved', 'success');
  }

  function loadCookiePreferences() {
      const preferences = getCookieValue('cookie_preference') === 'true';
      const analytics = getCookieValue('cookie_analytics') === 'true';
      const marketing = getCookieValue('cookie_marketing') === 'true';

      const preferencesCheckbox = document.getElementById('preferenceCookies');
      const analyticsCheckbox = document.getElementById('analyticsCookies');
      const marketingCheckbox = document.getElementById('marketingCookies');

      if (preferencesCheckbox) preferencesCheckbox.checked = preferences;
      if (analyticsCheckbox) analyticsCheckbox.checked = analytics;
      if (marketingCheckbox) marketingCheckbox.checked = marketing;
  }

  function initializeOptionalServices() {
      if (getCookiePreference('analytics')) {
          initializeAnalytics();
      }
      if (getCookiePreference('marketing')) {
          initializeMarketing();
      }
      if (getCookiePreference('preference')) {
          initializePreferences();
      }
  }

  function initializeAnalytics() {
      console.log('Analytics cookies enabled - initializing analytics');
  }

  function initializeMarketing() {
      console.log('Marketing cookies enabled - initializing marketing tools');
  }

  function initializePreferences() {
      console.log('Preference cookies enabled - initializing personalization');
  }

  function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.textContent = message;

      Object.assign(notification.style, {
          position: 'fixed',
          top: '20px',
          right: '20px',
          padding: '1rem 1.5rem',
          backgroundColor: type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6',
          color: 'white',
          borderRadius: '8px',
          boxShadow: '0 10px 25px rgba(0, 0, 0, 0.2)',
          zIndex: '9999',
          transform: 'translateX(100%)',
          transition: 'transform 0.3s ease',
          maxWidth: '300px',
          wordWrap: 'break-word'
      });

      document.body.appendChild(notification);

      setTimeout(() => {
          notification.style.transform = 'translateX(0)';
      }, 100);

      setTimeout(() => {
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
              if (notification.parentNode) {
                  notification.parentNode.removeChild(notification);
              }
          }, 300);
      }, 5000);
  }

  function initializeCookieConsent() {
      console.log('Initializing cookie consent...');

      if (!hasGivenConsent()) {
          console.log('No consent given, showing banner in 1.5s...');
          setTimeout(() => {
              showCookieBanner();
          }, 1500);
      } else {
          console.log('Consent already given, initializing services...');
          initializeOptionalServices();
      }

      const cookieSettingsOverlay = document.getElementById('cookieSettingsOverlay');
      if (cookieSettingsOverlay) {
          cookieSettingsOverlay.addEventListener('click', function(e) {
              if (e.target === this) {
                  closeCookieSettings();
              }
          });
      }

      document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
              const overlay = document.getElementById('cookieSettingsOverlay');
              if (overlay && overlay.classList.contains('show')) {
                  closeCookieSettings();
              }
          }
      });
  }

  function initializeMobileNav() {
      const hamburger = document.getElementById('hamburger');
      const navMenu = document.getElementById('nav-menu');

      if (hamburger && navMenu) {
          hamburger.addEventListener('click', function() {
              hamburger.classList.toggle('active');
              navMenu.classList.toggle('active');
          });

          const navLinks = document.querySelectorAll('.nav-link');
          navLinks.forEach(link => {
              link.addEventListener('click', function() {
                  hamburger.classList.remove('active');
                  navMenu.classList.remove('active');
              });
          });

          document.addEventListener('click', function(event) {
              const isClickInsideNav = navMenu.contains(event.target);
              const isClickOnHamburger = hamburger.contains(event.target);

              if (!isClickInsideNav && !isClickOnHamburger && navMenu.classList.contains('active')) {
                  hamburger.classList.remove('active');
                  navMenu.classList.remove('active');
              }
          });
      }
  }

  window.showCookieBanner = showCookieBanner;
  window.hideCookieBanner = hideCookieBanner;
  window.showCookieSettings = showCookieSettings;
  window.closeCookieSettings = closeCookieSettings;
  window.acceptAllCookies = acceptAllCookies;
  window.declineCookies = declineCookies;
  window.saveCookieSettings = saveCookieSettings;
  window.initializeCookieConsent = initializeCookieConsent;
  window.showNotification = showNotification;

  document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded - starting initialization');

      initializeMobileNav();

      initializeCookieConsent();

      const banner = document.getElementById('cookieConsentBanner');
      console.log('Cookie banner found:', !!banner);
      console.log('Has consent:', hasGivenConsent());

      console.log('=== INITIALIZATION COMPLETE ===');
  });
</script>

<script th:src="@{/js/script.js}" async onerror="console.log('External script failed to load, using inline version')"></script>
</body>
</html>